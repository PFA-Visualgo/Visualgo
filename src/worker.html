<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>PyScript Next</title>
    <!-- we are on 2024.1.3 now -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.3/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.3/core.js"></script>

</head>
<body>
<script type="py" config="./pyscript.json">
    from pyscript import document
    from comm_api import to_worker
    import time

    def handle_increment(event):
        button = document.getElementById("incr")
        button.disabled = True
        to_worker.send_message("CONTINUE", ([i for i in range(100)], time.time()))

    def handle_cpt(mes_id, mes_data):
        button = document.getElementById("incr")
        button.disabled = False
        cptDiv = document.getElementById("cpt")
        cptDiv.textContent = str(mes_data)

    to_worker.set_message_handler(handle_cpt)


</script>
<script type="py" id="worker" config="./pyscript.json" worker>
    from comm_api import from_worker
    import time

    print("worker on")

    cpt = 0

    while True:
        mes_id = None
        mes_data = None
        while mes_id != "CONTINUE":
            from_worker.send_message("CPT", cpt)
            mes_id,mes_data = from_worker.wait_for_main_message()
            cur_time = time.time()
            print((cur_time - mes_data[1]) * 1000)
        cpt += 1
</script>
<button py-click="handle_increment" disabled id="incr">Increment</button>
<div id="cpt">loading...</div>
</body>
</html>